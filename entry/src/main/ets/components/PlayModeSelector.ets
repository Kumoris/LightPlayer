import { PlayMode } from '../model/PlayState'

/**
 * æ’­æ”¾æ¨¡å¼ä¿¡æ¯
 */
interface PlayModeItem {
  mode: PlayMode
  name: string
  icon: string
  description: string
  color: string
}

/**
 * æ’­æ”¾æ¨¡å¼é€‰æ‹©å™¨é¢æ¿
 * æ˜¾ç¤ºæ‰€æœ‰7ç§æ’­æ”¾æ¨¡å¼ï¼Œç”¨æˆ·å¯ç›´æŽ¥é€‰æ‹©
 */
@CustomDialog
export struct PlayModeSelector {
  controller: CustomDialogController
  @Prop currentMode: PlayMode = PlayMode.SEQUENCE
  onModeSelected?: (mode: PlayMode) => void

  private readonly PLAY_MODES: PlayModeItem[] = [
    {
      mode: PlayMode.SEQUENCE,
      name: 'é¡ºåºæ’­æ”¾',
      icon: 'â–¶ï¸',
      description: 'æŒ‰ç…§åˆ—è¡¨é¡ºåºä¾æ¬¡æ’­æ”¾',
      color: '#007AFF'
    },
    {
      mode: PlayMode.LOOP,
      name: 'åˆ—è¡¨å¾ªçŽ¯',
      icon: 'ðŸ”',
      description: 'æ’­æ”¾å®Œåˆ—è¡¨åŽé‡æ–°å¼€å§‹',
      color: '#34C759'
    },
    {
      mode: PlayMode.SINGLE,
      name: 'å•æ›²å¾ªçŽ¯',
      icon: 'ðŸ”‚',
      description: 'é‡å¤æ’­æ”¾å½“å‰æ­Œæ›²',
      color: '#FF9500'
    },
    {
      mode: PlayMode.SMART_SHUFFLE,
      name: 'æ™ºèƒ½éšæœº',
      icon: 'ðŸ§ ',
      description: 'é¿å…åŒæµæ´¾/ä¸“è¾‘è¿žç»­æ’­æ”¾',
      color: '#AF52DE'
    },
    {
      mode: PlayMode.TIME_AWARE,
      name: 'æ—¶é—´æ„ŸçŸ¥',
      icon: 'ðŸ•’',
      description: 'æ ¹æ®æ—¶æ®µæ™ºèƒ½é€‰æ‹©æ­Œæ›²',
      color: '#5856D6'
    },
    {
      mode: PlayMode.NIGHT_MODE,
      name: 'å¤œé—´æ¨¡å¼',
      icon: 'ðŸŒ™',
      description: 'èˆ’ç¼“éŸ³ä¹ï¼ŒéŸ³é‡æ¸å¼±',
      color: '#5AC8FA'
    }
  ]

  build() {
    Column() {
      // æ ‡é¢˜
      Row() {
        Text('é€‰æ‹©æ’­æ”¾æ¨¡å¼')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')

        Blank()

        // å…³é—­æŒ‰é’®
        Text('âœ•')
          .fontSize(24)
          .fontColor('#999999')
          .onClick(() => {
            this.controller.close()
          })
      }
      .width('100%')
      .padding({ left: 20, right: 20, top: 20, bottom: 16 })

      Divider()

      // æ¨¡å¼åˆ—è¡¨
      List({ space: 0 }) {
        ForEach(this.PLAY_MODES, (item: PlayModeItem) => {
          ListItem() {
            this.PlayModeItem(item)
          }
        })
      }
      .layoutWeight(1)
      .divider({
        strokeWidth: 1,
        color: '#F0F0F0',
        startMargin: 20,
        endMargin: 20
      })

      // æç¤ºä¿¡æ¯
      Row() {
        Text('ðŸ’¡ æç¤º')
          .fontSize(12)
          .fontColor('#999999')

        Text('æ™ºèƒ½æ¨¡å¼éœ€è¦æ­Œæ›²å…ƒæ•°æ®æ”¯æŒ')
          .fontSize(12)
          .fontColor('#999999')
          .margin({ left: 4 })
      }
      .width('100%')
      .padding({ left: 20, right: 20, top: 12, bottom: 16 })
      .backgroundColor('#F8F8F8')
    }
    .width('100%')
    .height('70%')
    .backgroundColor('#FFFFFF')
    .borderRadius({ topLeft: 16, topRight: 16 })
  }

  /**
   * æ’­æ”¾æ¨¡å¼é€‰é¡¹
   */
  @Builder
  PlayModeItem(item: PlayModeItem) {
    Row() {
      // å›¾æ ‡
      Stack() {
        Circle()
          .width(48)
          .height(48)
          .fill(this.currentMode === item.mode ? item.color : '#F0F0F0')

        Text(item.icon)
          .fontSize(24)
      }
      .margin({ right: 16 })

      // æ–‡å­—ä¿¡æ¯
      Column({ space: 4 }) {
        Row() {
          Text(item.name)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333333')

          // å½“å‰ä½¿ç”¨æ ‡è®°
          if (this.currentMode === item.mode) {
            Text('ä½¿ç”¨ä¸­')
              .fontSize(12)
              .fontColor('#FFFFFF')
              .backgroundColor(item.color)
              .borderRadius(10)
              .padding({ top: 2, bottom: 2, left: 8, right: 8 })
              .margin({ left: 8 })
          }

          // æ–°åŠŸèƒ½æ ‡è®°
          if (item.mode === PlayMode.SMART_SHUFFLE ||
              item.mode === PlayMode.TIME_AWARE ||
              item.mode === PlayMode.NIGHT_MODE) {
            Text('NEW')
              .fontSize(10)
              .fontColor('#FF3B30')
              .fontWeight(FontWeight.Bold)
              .border({ width: 1, color: '#FF3B30', radius: 8 })
              .padding({ top: 1, bottom: 1, left: 6, right: 6 })
              .margin({ left: 6 })
          }
        }

        Text(item.description)
          .fontSize(14)
          .fontColor('#666666')
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      // é€‰æ‹©æŒ‡ç¤ºå™¨
      if (this.currentMode === item.mode) {
        Text('âœ“')
          .fontSize(24)
          .fontColor(item.color)
          .fontWeight(FontWeight.Bold)
      } else {
        Text('â€º')
          .fontSize(24)
          .fontColor('#CCCCCC')
      }
    }
    .width('100%')
    .padding({ left: 20, right: 20, top: 16, bottom: 16 })
    .backgroundColor(this.currentMode === item.mode ? '#F8F9FA' : '#FFFFFF')
    .onClick(() => {
      this.onModeSelected?.(item.mode)
      this.controller.close()
    })
  }
}
