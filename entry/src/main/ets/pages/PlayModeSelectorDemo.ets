import { PlayMode } from '../model/PlayState'
import { PlayModeSelector } from '../components/PlayModeSelector'

/**
 * æ’­æ”¾æ¨¡å¼é€‰æ‹©ç¤ºä¾‹é¡µé¢
 * æ¼”ç¤ºå¦‚ä½•é›†æˆæ’­æ”¾æ¨¡å¼é€‰æ‹©å™¨
 */
@Entry
@Component
struct PlayModeSelectorDemo {
  @State currentMode: PlayMode = PlayMode.SEQUENCE
  @State modeName: string = 'é¡ºåºæ’­æ”¾'
  private dialogController: CustomDialogController | null = null

  build() {
    Column() {
      // æ ‡é¢˜
      Text('æ’­æ”¾æ¨¡å¼é€‰æ‹©å™¨ç¤ºä¾‹')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 40, bottom: 20 })

      // å½“å‰æ¨¡å¼æ˜¾ç¤º
      Column() {
        Text('å½“å‰æ¨¡å¼')
          .fontSize(14)
          .fontColor('#999999')
          .margin({ bottom: 8 })

        Text(this.modeName)
          .fontSize(20)
          .fontWeight(FontWeight.Medium)
          .fontColor('#007AFF')

        Text(`PlayMode å€¼: ${this.currentMode}`)
          .fontSize(12)
          .fontColor('#666666')
          .margin({ top: 4 })
      }
      .width('100%')
      .padding(20)
      .backgroundColor('#F8F8F8')
      .borderRadius(12)
      .margin({ bottom: 20 })

      // æ‰“å¼€é€‰æ‹©å™¨æŒ‰é’®
      Button('é€‰æ‹©æ’­æ”¾æ¨¡å¼')
        .fontSize(16)
        .width('100%')
        .height(50)
        .backgroundColor('#007AFF')
        .onClick(() => {
          this.showModeSelector()
        })

      // è¯´æ˜æ–‡å­—
      Text('ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹æ‰€æœ‰6ç§æ’­æ”¾æ¨¡å¼')
        .fontSize(14)
        .fontColor('#999999')
        .margin({ top: 16 })

      Blank()

      // æ¨¡å¼åˆ—è¡¨
      Text('æ‰€æœ‰å¯ç”¨æ¨¡å¼:')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 12 })

      Column({ space: 8 }) {
        this.ModeListItem('é¡ºåºæ’­æ”¾', 'SEQUENCE')
        this.ModeListItem('åˆ—è¡¨å¾ªç¯', 'LOOP')
        this.ModeListItem('å•æ›²å¾ªç¯', 'SINGLE')
        this.ModeListItem('æ™ºèƒ½éšæœº ğŸ†•', 'SMART_SHUFFLE')
        this.ModeListItem('æ—¶é—´æ„ŸçŸ¥ ğŸ†•', 'TIME_AWARE')
        this.ModeListItem('å¤œé—´æ¨¡å¼ ğŸ†•', 'NIGHT_MODE')
      }
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .height('100%')
    .padding(20)
    .backgroundColor('#FFFFFF')
  }

  @Builder
  ModeListItem(name: string, mode: string) {
    Row() {
      Text('â€¢')
        .fontSize(20)
        .fontColor('#007AFF')
        .margin({ right: 8 })

      Text(name)
        .fontSize(14)
        .fontColor('#333333')
    }
  }

  /**
   * æ˜¾ç¤ºæ’­æ”¾æ¨¡å¼é€‰æ‹©å™¨
   */
  showModeSelector(): void {
    this.dialogController = new CustomDialogController({
      builder: PlayModeSelector({
        currentMode: this.currentMode,
        onModeSelected: (mode: PlayMode) => {
          this.currentMode = mode
          this.updateModeName(mode)
        }
      }),
      customStyle: true,
      alignment: DialogAlignment.Bottom
    })

    this.dialogController.open()
  }

  /**
   * æ›´æ–°æ¨¡å¼åç§°
   */
  updateModeName(mode: PlayMode): void {
    switch (mode) {
      case PlayMode.SEQUENCE:
        this.modeName = 'é¡ºåºæ’­æ”¾'
        break
      case PlayMode.LOOP:
        this.modeName = 'åˆ—è¡¨å¾ªç¯'
        break
      case PlayMode.SINGLE:
        this.modeName = 'å•æ›²å¾ªç¯'
        break
      case PlayMode.SMART_SHUFFLE:
        this.modeName = 'æ™ºèƒ½éšæœº'
        break
      case PlayMode.TIME_AWARE:
        this.modeName = 'æ—¶é—´æ„ŸçŸ¥'
        break
      case PlayMode.NIGHT_MODE:
        this.modeName = 'å¤œé—´æ¨¡å¼'
        break
      default:
        this.modeName = 'æœªçŸ¥æ¨¡å¼'
    }
  }
}
